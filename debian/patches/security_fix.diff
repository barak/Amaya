Merged upstream
Index: amaya-9.55~dfsg.0/thotlib/unicode/ustring.c
===================================================================
--- amaya-9.55~dfsg.0.orig/thotlib/unicode/ustring.c	2007-07-17 22:55:48.000000000 +0100
+++ amaya-9.55~dfsg.0/thotlib/unicode/ustring.c	2007-07-17 23:02:19.000000000 +0100
@@ -12,6 +12,7 @@
 
 #include <stdio.h>
 #include <stdlib.h>
+#include <langinfo.h>
 #include "thot_sys.h"
 #include "fileaccess.h"
 
@@ -434,36 +435,10 @@
 #ifndef _MACOS
   if (LocaleSystemCharset == UNSUPPORTED_CHARSET)
     {
-      char * lang = getenv("LANG");
-#ifdef _WX
-      if (lang && TtaDirExists ("/tmp"))
-#else /* _WX */
-      if (lang && ThotDirExists ("/tmp"))
-#endif /* _WX */
-        {
-          int  fd;
-          char buffer[256], cmd[256], filename[30];
-          memset ( buffer, 0, 256);
-          strcpy (cmd, "locale -ck LC_MESSAGES | grep messages-codeset | sed 's/.*=\"//' | sed 's/\"//'");
-          strcat (cmd," > ");
-          strcpy (filename, "/tmp/");
-          strcat (filename,"amaya_locale");
-          strcat (cmd, filename);
-          /* ask the system using locale command */
-          system (cmd);
-          fd = open (filename, O_RDONLY);
-          if (fd)
-            {
-              read (fd, buffer, 255);
-              close (fd);
-              strcpy (cmd, "rm -f ");
-              strcat (cmd, filename);
-              system (cmd);
-              buffer[255] = EOS;
-              /* convert the string into thotlib index */
-              LocaleSystemCharset = TtaGetCharset(buffer); 
-            }
-        }
+      char *buffer;
+      buffer = nl_langinfo(_NL_MESSAGES_CODESET);
+      if (buffer != NULL)
+        LocaleSystemCharset = TtaGetCharset(buffer);
     }
 #endif /* _MACOS */
   if ((LocaleSystemCharset == UNSUPPORTED_CHARSET) ||
